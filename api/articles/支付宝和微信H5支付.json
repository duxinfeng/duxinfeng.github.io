{"title":"支付宝和微信H5支付","uid":"3c6523be4dd3fc2c3a351c54c5524bfa","slug":"支付宝和微信H5支付","date":"2019-02-23T05:22:54.000Z","updated":"2020-03-11T13:28:21.000Z","comments":true,"path":"api/articles/支付宝和微信H5支付.json","keywords":null,"cover":null,"content":"<p>因业务需要，移除项目中支付宝支付SDK和微信支付的SDK,改为网页支付。通过H5网页调起微信和支付宝的客户端进行支付，支付完成返回客户端，做到调用SDK一样的体验。</p>\n<p>支付宝和微信建议以App的方式集成， 都不建议在app内部使用网页来支付，但也没有不允许，目前可行，不过也说不好以后会不会禁止这种方式。</p>\n<pre class=\"line-numbers language-objective-c\" data-language=\"objective-c\"><code class=\"language-objective-c\">- (void)webView:(WKWebView *)webView decidePolicyForNavigationAction:(WKNavigationAction *)navigationAction decisionHandler:(void (^)(WKNavigationActionPolicy))decisionHandler &#123;\n\n    NSString* url &#x3D; navigationAction.request.URL.absoluteString;\n\n    if ([url hasPrefix:@&quot;alipays:&#x2F;&#x2F;&quot;] || [url hasPrefix:@&quot;alipay:&#x2F;&#x2F;&quot;]) &#123;\n\n        BOOL success &#x3D; [[UIApplication sharedApplication]openURL:navigationAction.request.URL];\n        if (success) &#123;\n\n        &#125;\n\n    &#125;\n\n    if ([url hasPrefix:@&quot;weixin:&#x2F;&#x2F;wap&#x2F;pay&quot;]) &#123;\n\n        BOOL success &#x3D; [[UIApplication sharedApplication]openURL:navigationAction.request.URL];\n\n        if (success) &#123;\n\n\t    &#125;\n\n    &#125;\n\n    decisionHandler(WKNavigationActionPolicyAllow);\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>微信支付回调问题</p>\n<p>TARGETS → Info →  URL Types 增加一项 URL Schemes 填写回调的url <code>www.xxx.com</code></p>\n<pre class=\"line-numbers language-objective-c\" data-language=\"objective-c\"><code class=\"language-objective-c\">NSMutableURLRequest *request &#x3D; [NSMutableURLRequest requestWithURL:[NSURL URLWithString:self.urlstring]];\nNSDictionary *headers &#x3D; [request allHTTPHeaderFields];\nBOOL hasReferer &#x3D; [headers objectForKey:@&quot;Referer&quot;] !&#x3D; nil;\nif (!hasReferer) &#123;\n       [request setValue:@&quot;www.xxx.com:&#x2F;&#x2F;&quot; forHTTPHeaderField: @&quot;Referer&quot;];\n  &#125;\n[self.webView loadRequest:request];\n            \n             <span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n\n<p>注意：</p>\n<ol>\n<li>在iOS系统中，唤起支付宝App支付完成后，不会自动回到浏览器或商户App。用户可手工切回到浏览器或商户App。</li>\n<li>审核过程中，除了隐藏入口，代码和注释里面一些包含 支付宝支付 alipay 微信支付 weixinpay weichatpay 类似这样的字段要屏蔽掉，否则在审核期间扫描代码的时候因为隐藏功能而拒审核，最好还是老老实实接苹果支付。</li>\n</ol>\n<p>参考链接：</p>\n<p><a href=\"https://docs.open.alipay.com/203/107091/\">https://docs.open.alipay.com/203/107091/</a></p>\n<p><a href=\"https://docs.open.alipay.com/203\">https://docs.open.alipay.com/203</a></p>\n<p><a href=\"https://nearwmy.github.io/2017/12/04/%E5%BE%AE%E4%BF%A1H5%E6%94%AF%E4%BB%98%E4%B9%8B%E5%9B%9E%E8%B7%B3%20safari%20%E6%B5%8F%E8%A7%88%E5%99%A8/\">https://nearwmy.github.io/2017/12/04/%E5%BE%AE%E4%BF%A1H5%E6%94%AF%E4%BB%98%E4%B9%8B%E5%9B%9E%E8%B7%B3%20safari%20%E6%B5%8F%E8%A7%88%E5%99%A8/</a></p>\n<p><a href=\"https://github.com/mjl123iOS/iOS_WXh5\">https://github.com/mjl123iOS/iOS_WXh5</a></p>\n<p><a href=\"https://github.com/cheenbee/cheenbee.github.io/issues/1\">https://github.com/cheenbee/cheenbee.github.io/issues/1</a></p>\n","text":"因业务需要，移除项目中支付宝支付SDK和微信支付的SDK,改为网页支付。通过H5网页调起微信和支付宝的客户端进行支付，支付完成返回客户端，做到调用SDK一样的体验。 支付宝和微信建议以App的方式集成， 都不建议在app内部使用网页来支付，但也没有不允许，目前可行，不过也说不好以...","link":"","photos":[],"count_time":{"symbolsCount":"2k","symbolsTime":"2 mins."},"categories":[{"name":"iOS","slug":"iOS","count":36,"path":"api/categories/iOS.json"}],"tags":[{"name":"微信支付","slug":"微信支付","count":1,"path":"api/tags/微信支付.json"},{"name":"支付宝支付","slug":"支付宝支付","count":1,"path":"api/tags/支付宝支付.json"}],"toc":"","author":{"name":"新风作浪","slug":"blog-author","avatar":"http://qiniu.niuxtech.cn/avatar.png","link":"/","description":"专注于你能控制的","socials":{"github":"https://github.com/duxinfeng","twitter":"https://twitter.com/iduxinfeng","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/duxinfeng2010","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"ERROR ITMS-90474： iPad Multitasking support requires these orientations","uid":"f9a4dc44aa06958286dce7a8891ef43b","slug":"ERROR-ITMS-90474：-iPad-Multitasking-support-requires-these-orientations","date":"2019-10-18T08:14:21.000Z","updated":"2020-03-11T12:49:34.000Z","comments":true,"path":"api/articles/ERROR-ITMS-90474：-iPad-Multitasking-support-requires-these-orientations.json","keywords":null,"cover":[],"text":" 上传AppStore时候发现ERROR ITMS-90474错误 ERROR ITMS-90474: “Invalid Bundle. iPad Multitasking support requires these orientations: ‘UIInterfaceOrie...","link":"","photos":[],"count_time":{"symbolsCount":559,"symbolsTime":"1 mins."},"categories":[{"name":"iOS","slug":"iOS","count":36,"path":"api/categories/iOS.json"}],"tags":[{"name":"APP","slug":"APP","count":1,"path":"api/tags/APP.json"},{"name":"ERROR","slug":"ERROR","count":1,"path":"api/tags/ERROR.json"}],"author":{"name":"新风作浪","slug":"blog-author","avatar":"http://qiniu.niuxtech.cn/avatar.png","link":"/","description":"专注于你能控制的","socials":{"github":"https://github.com/duxinfeng","twitter":"https://twitter.com/iduxinfeng","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/duxinfeng2010","juejin":"","customs":{}}}},"next_post":{"title":"佛祖保佑,永无BUG","uid":"f95a3c14c04c37631e296772fa4115ca","slug":"佛祖保佑-永无BUG","date":"2018-10-15T07:23:34.000Z","updated":"2020-03-28T15:58:10.000Z","comments":true,"path":"api/articles/佛祖保佑-永无BUG.json","keywords":null,"cover":[],"text":"收藏几个有趣的代码注释 一 &#x2F;* * _ooOoo_ * o8888888o * 88&quot; . &quot;88 * (| -_- |) * O\\ &#x3D; &#x2F;O * ____&#x2F;&#96;---&#39;\\____ * .&#39; \\\\...","link":"","photos":[],"count_time":{"symbolsCount":"9.4k","symbolsTime":"9 mins."},"categories":[{"name":"备忘","slug":"备忘","count":3,"path":"api/categories/备忘.json"}],"tags":[{"name":"注释","slug":"注释","count":1,"path":"api/tags/注释.json"}],"author":{"name":"新风作浪","slug":"blog-author","avatar":"http://qiniu.niuxtech.cn/avatar.png","link":"/","description":"专注于你能控制的","socials":{"github":"https://github.com/duxinfeng","twitter":"https://twitter.com/iduxinfeng","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/duxinfeng2010","juejin":"","customs":{}}}}}