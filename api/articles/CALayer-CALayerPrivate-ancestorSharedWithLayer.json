{"title":"[CALayer(CALayerPrivate) ancestorSharedWithLayer:] ","uid":"dfc46367d6c5d8c8d972785531f52fd4","slug":"CALayer-CALayerPrivate-ancestorSharedWithLayer","date":"2022-08-31T10:59:37.000Z","updated":"2022-09-01T06:08:31.813Z","comments":true,"path":"api/articles/CALayer-CALayerPrivate-ancestorSharedWithLayer.json","keywords":null,"cover":"http://qiniu.niuxtech.cn/2022/blog_placeholder_015.jpg","content":"<p>[CALayer(CALayerPrivate) ancestorSharedWithLayer:]  错误日志：</p>\n<pre class=\"line-numbers language-objective-c\" data-language=\"objective-c\"><code class=\"language-objective-c\">Crashed: com.apple.main-thread\n0  QuartzCore                     0x23790 CA::Layer::superlayer(CA::Transaction*) + 28\n1  QuartzCore                     0xad748 -[CALayer(CALayerPrivate) ancestorSharedWithLayer:] + 112\n2  QuartzCore                     0x1d010 CA::Layer::map_geometry(CALayer*, CALayer*, void (*)(void*, CA::Mat4&lt;double&gt; const&amp;), void (*)(void*, CA::Mat4&lt;double&gt; const&amp;), void*) + 136\n3  QuartzCore                     0xc9c94 -[CALayer convertPoint:toLayer:] + 80\n4  UIKitCore                      0x234cd4 -[UIView(Geometry) convertPoint:toView:] + 112\n5  UIAccessibility                0x1b960 -[NSObject(AXPrivCategory) _accessibilityBaseHitTest:withEvent:] + 3416\n6  UIKit                          0xce494 -[UIViewAccessibility _accessibilityHitTest:withEvent:] + 160\n7  UIKit                          0xa4318 -[UITableViewCellAccessibility _accessibilityHitTest:withEvent:] + 2280\n8  UIKit                          0xccc88 -[UIViewAccessibility __accessibilityHitTest:withEvent:] + 1604\n9  UIKit                          0x96cc0 -[UITableViewAccessibility _accessibilityHitTest:withEvent:] + 164\n10 PreferencesFramework           0xb6fc (缺少 UUID a69f299d65e639d69a322e24499981e1)\n11 UIAccessibility                0x1bd68 __64-[NSObject(AXPrivCategory) _accessibilityBaseHitTest:withEvent:]_block_invoke.274 + 112\n12 UIAccessibility                0x1b514 -[NSObject(AXPrivCategory) _accessibilityBaseHitTest:withEvent:] + 2316\n13 UIKit                          0xce494 -[UIViewAccessibility _accessibilityHitTest:withEvent:] + 160\n14 UIKit                          0xccc88 -[UIViewAccessibility __accessibilityHitTest:withEvent:] + 1604\n15 UIKit                          0xce464 -[UIViewAccessibility _accessibilityHitTest:withEvent:] + 112\n16 UIKit                          0xccc88 -[UIViewAccessibility __accessibilityHitTest:withEvent:] + 1604\n17 UIKit                          0xce464 -[UIViewAccessibility _accessibilityHitTest:withEvent:] + 112\n18 UIKit                          0x3f1d4 -[UICollectionViewCellAccessibility _accessibilityHitTest:withEvent:] + 120\n19 UIKit                          0xccc88 -[UIViewAccessibility __accessibilityHitTest:withEvent:] + 1604\n20 UIKit                          0x3ae38 -[UICollectionViewAccessibility _accessibilityHitTest:withEvent:] + 228\n21 UIKit                          0xccc88 -[UIViewAccessibility __accessibilityHitTest:withEvent:] + 1604\n22 UIKit                          0xce464 -[UIViewAccessibility _accessibilityHitTest:withEvent:] + 112\n23 UIKit                          0xccc88 -[UIViewAccessibility __accessibilityHitTest:withEvent:] + 1604\n24 UIKit                          0xce464 -[UIViewAccessibility _accessibilityHitTest:withEvent:] + 112\n25 UIKit                          0xccc88 -[UIViewAccessibility __accessibilityHitTest:withEvent:] + 1604\n26 UIKit                          0xce464 -[UIViewAccessibility _accessibilityHitTest:withEvent:] + 112\n27 UIKit                          0xccc88 -[UIViewAccessibility __accessibilityHitTest:withEvent:] + 1604\n28 UIKit                          0xce464 -[UIViewAccessibility _accessibilityHitTest:withEvent:] + 112\n29 UIKit                          0xccc88 -[UIViewAccessibility __accessibilityHitTest:withEvent:] + 1604\n30 UIKit                          0xce464 -[UIViewAccessibility _accessibilityHitTest:withEvent:] + 112\n31 UIKit                          0xccc88 -[UIViewAccessibility __accessibilityHitTest:withEvent:] + 1604\n32 UIKit                          0xce464 -[UIViewAccessibility _accessibilityHitTest:withEvent:] + 112\n33 UIKit                          0xccc88 -[UIViewAccessibility __accessibilityHitTest:withEvent:] + 1604\n34 UIKit                          0xce464 -[UIViewAccessibility _accessibilityHitTest:withEvent:] + 112\n35 UIKit                          0xccc88 -[UIViewAccessibility __accessibilityHitTest:withEvent:] + 1604\n36 UIKit                          0xce464 -[UIViewAccessibility _accessibilityHitTest:withEvent:] + 112\n37 UIKit                          0xccc88 -[UIViewAccessibility __accessibilityHitTest:withEvent:] + 1604\n38 UIKit                          0xce464 -[UIViewAccessibility _accessibilityHitTest:withEvent:] + 112\n39 UIKit                          0xccc88 -[UIViewAccessibility __accessibilityHitTest:withEvent:] + 1604\n40 UIKit                          0xce464 -[UIViewAccessibility _accessibilityHitTest:withEvent:] + 112\n41 UIKit                          0xccc88 -[UIViewAccessibility __accessibilityHitTest:withEvent:] + 1604\n42 UIKit                          0xce464 -[UIViewAccessibility _accessibilityHitTest:withEvent:] + 112\n43 UIKit                          0xccc88 -[UIViewAccessibility __accessibilityHitTest:withEvent:] + 1604\n44 UIKit                          0xce464 -[UIViewAccessibility _accessibilityHitTest:withEvent:] + 112\n45 UIKit                          0xd6590 -[UIWindowAccessibility _accessibilityHitTest:withEvent:] + 144\n46 UIAccessibility                0x628c _copyElementAtPositionCallback + 1952\n47 AXRuntime                      0xc7f4 ___AXXMIGCopyElementAtPosition_block_invoke + 72\n48 AXRuntime                      0xb680 _handleNonMainThreadCallback + 72\n49 AXRuntime                      0xc67c _AXXMIGCopyElementAtPosition + 268\n50 AXRuntime                      0x7f48 _AXUIElementCopyElementAtPositionWithParams + 2648\n51 UIAccessibility                0x24b44 -[NSObject(AXPrivCategory) _accessibilityVisiblePointHitTestingAnyElement:] + 2852\n52 UIAccessibility                0x25020 -[NSObject(AXPrivCategory) _accessibilityIsVisibleByCompleteHitTest:] + 196\n53 UIAccessibility                0x30010 -[NSObject(AXPrivCategory) _iosAccessibilityAttributeValue:] + 10488<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n\n<p>这个Bug由来已久，崩溃日志每个版本都会有一两个用户，复现好久都没复现出来，看日志信息也不知道咋解决。唯一搜索到相关的是这个 <a href=\"https://www.cocoanetics.com/2013/11/radar-accessibility-based-tools-crash-app-running-in-ios-7-simulator/\">https://www.cocoanetics.com/2013/11/radar-accessibility-based-tools-crash-app-running-in-ios-7-simulator/</a> ，因为项目中使用DTCoreText ，猜测肯定是自定义View然后丢给 DTCoreText 上渲染引起的。终于捉到一个用户反馈，发来视频，几乎一样的环境系统没发现出来问题，最在无可奈何的时候发现状态栏是昂有个蓝色的话筒，经过一番查找资料，这是iOS系统的辅助功能“语音控制”。</p>\n<p>然后在系统 <strong>设置 –&gt; 辅助功能 –&gt; 语音控制 –&gt; 关闭</strong>时，发现不崩了。</p>\n<p>当时也没找到问题所在价加上着急发版，又有很多需求，只让用户关闭语音控制功能。时隔两三年又来用户反馈，缺怎么越记不起怎么操作的，记忆里在衰退了。</p>\n<p>后台经过二分法注释代码，发现是自定义的一个 View  上 add 了一个 textField。isAccessibilityElement 默认打开，关闭这个属性即可。</p>\n<pre class=\"line-numbers language-objective-c\" data-language=\"objective-c\"><code class=\"language-objective-c\">self.textField &#x3D; [[UITextField alloc] init];\nself.textField.isAccessibilityElement &#x3D; NO;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span></span></code></pre>\n\n<p>这里面涉及无障碍框架 UIAccessibility。</p>\n<p>参考链接：</p>\n<p>1、<a href=\"https://www.jianshu.com/p/0991a4f0bc0c\">https://www.jianshu.com/p/0991a4f0bc0c</a></p>\n<p>2、<a href=\"https://developer.apple.com/documentation/objectivec/nsobject/1615141-isaccessibilityelement?language=objc\">https://developer.apple.com/documentation/objectivec/nsobject/1615141-isaccessibilityelement?language=objc</a></p>\n","text":"[CALayer(CALayerPrivate) ancestorSharedWithLayer:] 错误日志： Crashed: com.apple.main-thread 0 QuartzCore 0x23790 CA::Layer::superlayer(CA::Trans...","link":"","photos":[],"count_time":{"symbolsCount":"6.6k","symbolsTime":"6 mins."},"categories":[],"tags":[{"name":"iOS","slug":"iOS","count":1,"path":"api/tags/iOS.json"}],"toc":"","author":{"name":"新风作浪","slug":"blog-author","avatar":"http://qiniu.niuxtech.cn/avatar.png","link":"/","description":"专注于你能控制的","socials":{"github":"https://github.com/duxinfeng","twitter":"https://twitter.com/iduxinfeng","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/duxinfeng2010","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"Signing for \"xxx\" requires a development team. select a development team in the signing & capabilities editor","uid":"c6ef05d2fbbbd9abff5f01500b306873","slug":"Signing-for-xxx-requires-a-development-team-select-a-development-team-in-the-signing-capabilities-editor","date":"2022-11-12T03:46:40.000Z","updated":"2022-12-02T06:18:08.877Z","comments":true,"path":"api/articles/Signing-for-xxx-requires-a-development-team-select-a-development-team-in-the-signing-capabilities-editor.json","keywords":null,"cover":"http://qiniu.niuxtech.cn/2022/blog_placeholder_016.jpg","text":"问题使用 Xcode 14 pod install 编译后报错，Signing for &quot;xxx&quot; requires a development team. select a development team in the signing &amp; capa...","link":"","photos":[],"count_time":{"symbolsCount":954,"symbolsTime":"1 mins."},"categories":[],"tags":[{"name":"Xcode14","slug":"Xcode14","count":1,"path":"api/tags/Xcode14.json"}],"author":{"name":"新风作浪","slug":"blog-author","avatar":"http://qiniu.niuxtech.cn/avatar.png","link":"/","description":"专注于你能控制的","socials":{"github":"https://github.com/duxinfeng","twitter":"https://twitter.com/iduxinfeng","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/duxinfeng2010","juejin":"","customs":{}}}},"next_post":{"title":"与友盟+的故事","uid":"81feb127868f67a4f977ce3aa92f351f","slug":"与友盟-的故事","date":"2022-08-17T08:04:19.000Z","updated":"2022-08-17T11:47:46.891Z","comments":true,"path":"api/articles/与友盟-的故事.json","keywords":null,"cover":"http://qiniu.niuxtech.cn/2022/blog_placeholder_014.jpg","text":"","link":"","photos":[],"count_time":{"symbolsCount":0,"symbolsTime":"1 mins."},"categories":[],"tags":[],"author":{"name":"新风作浪","slug":"blog-author","avatar":"http://qiniu.niuxtech.cn/avatar.png","link":"/","description":"专注于你能控制的","socials":{"github":"https://github.com/duxinfeng","twitter":"https://twitter.com/iduxinfeng","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/duxinfeng2010","juejin":"","customs":{}}}}}