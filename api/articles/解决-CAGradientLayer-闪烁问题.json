{"title":"解决 CAGradientLayer 闪烁问题","uid":"da83de5bcad815038766d45336f7a267","slug":"解决-CAGradientLayer-闪烁问题","date":"2021-05-05T17:29:43.000Z","updated":"2021-05-11T17:45:37.375Z","comments":true,"path":"api/articles/解决-CAGradientLayer-闪烁问题.json","keywords":null,"cover":null,"content":"<p>CAGradientLayer 是 CALayer 的子类，用于绘制带有渐变效果的图层。</p>\n<p>当我们在UIView 的Layer 上添加一个 CAGradientLayer 层的时候，如果</p>\n<p>需要更新 CAGradientLayer frame，如果更新frame前后不一样，会出现肉课件的闪烁过渡，看起来很怪。这是因为渐变色会有一个延迟的绘制过程。</p>\n<p>实现一个渐变背景的 UIView ：</p>\n<p>最开始的时候自定义</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">\t[self.layer addSublayer:self.vipPriceGradientLayer];\n\t\t\n- (CAGradientLayer *)vipPriceGradientLayer\n&#123;\n\tif (!_vipPriceGradientLayer) &#123;\n\t\tCAGradientLayer *gl &#x3D; [CAGradientLayer layer];\n\t\tgl.startPoint &#x3D; CGPointMake(0.62, 0);\n\t\tgl.endPoint &#x3D; CGPointMake(0.62, 1);\n\t\tgl.colors &#x3D; @[(__bridge id)[UIColor colorWithHexString:@&quot;#FEE5B6&quot;].CGColor, (__bridge id)[UIColor colorWithHexString:@&quot;#FED28B&quot;].CGColor];\n\t\tgl.locations &#x3D; @[@(0), @(1.0f)];\n\t\tgl.cornerRadius &#x3D; XXBPtScale(5);\n\t\t_vipPriceGradientLayer &#x3D; gl;\n\t&#125;\n\treturn _vipPriceGradientLayer;\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n\n\n<p>在设置frame的地方更新 self.vipPriceGradientLayer.frame = </p>\n<p>造成闪涉效果。</p>\n<p><a href=\"http://qiniu.niuxtech.cn/RPReplay_Final1619799024.mov\">http://qiniu.niuxtech.cn/RPReplay_Final1619799024.mov</a></p>\n<p>解决办法： 自定义 layerClass</p>\n<pre><code>+ (Class)layerClass\n&#123;\n    return [CAGradientLayer class];\n&#125;\n\n- (instancetype)init\n&#123;\n    self = [super init];\n    if (self) &#123;\n        \n        CAGradientLayer *gl = (CAGradientLayer *)self.layer;\n        gl.startPoint = CGPointMake(0.62, 0);\n        gl.endPoint = CGPointMake(0.62, 1);\n        gl.colors = @[(__bridge id)[UIColor colorWithHexString:@&quot;#FEE5B6&quot;].CGColor, (__bridge id)[UIColor colorWithHexString:@&quot;#FED28B&quot;].CGColor];\n        gl.locations = @[@(0), @(1.0f)];\n        gl.cornerRadius = XXBPtScale(5);\n        \n        self.frame = DF_FRAME(0, 0, 0,  XXBPtScale(19));\n        \n    &#125;\n    return self;\n&#125;\n        \n\n\n\n需要了解，UIView 和 CALayer 关系 。\n\n\n\n关于+ (Class)layerClass 方法  https://developer.apple.com/documentation/uikit/uiview/1622626-layerclass?language=objc\n</code></pre>\n","text":"CAGradientLayer 是 CALayer 的子类，用于绘制带有渐变效果的图层。 当我们在UIView 的Layer 上添加一个 CAGradientLayer 层的时候，如果 需要更新 CAGradientLayer frame，如果更新frame前后不一样，会出现肉课...","link":"","photos":[],"count_time":{"symbolsCount":"1.8k","symbolsTime":"2 mins."},"categories":[],"tags":[{"name":"CAGradientLayer","slug":"CAGradientLayer","count":1,"path":"api/tags/CAGradientLayer.json"}],"toc":"","author":{"name":"新风作浪","slug":"blog-author","avatar":"http://qiniu.niuxtech.cn/avatar.png","link":"/","description":"专注于你能控制的","socials":{"github":"https://github.com/duxinfeng","twitter":"https://twitter.com/iduxinfeng","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/duxinfeng2010","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"GTD工作法","uid":"a8cdd39e741b577b643ce2a429c48512","slug":"GTD工作法","date":"2021-05-24T15:18:31.000Z","updated":"2021-05-24T15:31:35.172Z","comments":true,"path":"api/articles/GTD工作法.json","keywords":null,"cover":[],"text":"GTD 全称 Getting Things Done，意思把事情做完。 其核心理念是必须记录下来要做的事，然后整理安排并让自己一一执行，大致分为收集、整理、组织、回顾和执行五大步骤 1. 收集将能够想到的所有应该去做的事情罗列于“待办事宜”中。 2. 整理将进入“待办事宜”的事项...","link":"","photos":[],"count_time":{"symbolsCount":568,"symbolsTime":"1 mins."},"categories":[],"tags":[{"name":"GTD","slug":"GTD","count":1,"path":"api/tags/GTD.json"}],"author":{"name":"新风作浪","slug":"blog-author","avatar":"http://qiniu.niuxtech.cn/avatar.png","link":"/","description":"专注于你能控制的","socials":{"github":"https://github.com/duxinfeng","twitter":"https://twitter.com/iduxinfeng","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/duxinfeng2010","juejin":"","customs":{}}}},"next_post":{"title":"碎碎念在2021年4月27日","uid":"8fb54573609195e458d704b3535fbe1e","slug":"碎碎念在2021年4月27日","date":"2021-04-27T15:38:07.000Z","updated":"2021-04-27T15:58:38.602Z","comments":true,"path":"api/articles/碎碎念在2021年4月27日.json","keywords":null,"cover":[],"text":"早上在奥林匹克森林公园站换乘地15号线的时候，脑子有点晕，明知道这边上车的人多不正常，还是上去了，做了两站发现坐反了。 发现昨天做截屏反馈功能以及测试工作的时候，截了图400多张图。 好消息–&gt; 又中了一手可转债。 ","link":"","photos":[],"count_time":{"symbolsCount":113,"symbolsTime":"1 mins."},"categories":[],"tags":[{"name":"碎碎念","slug":"碎碎念","count":8,"path":"api/tags/碎碎念.json"}],"author":{"name":"新风作浪","slug":"blog-author","avatar":"http://qiniu.niuxtech.cn/avatar.png","link":"/","description":"专注于你能控制的","socials":{"github":"https://github.com/duxinfeng","twitter":"https://twitter.com/iduxinfeng","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/duxinfeng2010","juejin":"","customs":{}}}}}