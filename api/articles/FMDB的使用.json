{"title":"FMDB的使用","uid":"1b1a4644b0bd397a00360966a4b49053","slug":"FMDB的使用","date":"2015-07-11T03:54:19.000Z","updated":"2020-03-11T13:35:08.000Z","comments":true,"path":"api/articles/FMDB的使用.json","keywords":null,"cover":null,"content":"<p>关于这篇Blog:</p>\n<p>网上也有不少写FMDB用法的，我为什么还在这里重造轮子？有两个目的：<br>1、自己做总结和备忘，在项目里会常用的东西<br>2、</p>\n<h3 id=\"FMDB介绍：\"><a href=\"#FMDB介绍：\" class=\"headerlink\" title=\"FMDB介绍：\"></a>FMDB介绍：</h3><p>下载地址：<a href=\"https://github.com/ccgus/fmdb\">https://github.com/ccgus/fmdb</a></p>\n<h3 id=\"如何集成\"><a href=\"#如何集成\" class=\"headerlink\" title=\"如何集成\"></a>如何集成</h3><p>1、如果你的工程使用了CocoaPods进行管理，直接 <code>pod &#39;FMDB&#39;</code> 或 <code>pod &#39;FMDB&#39;, &#39;~&gt; 2.5&#39;</code><br>2、下载源码，把src目录下的fmdb文件夹拖到工程，导入libsqlite3.dylib库</p>\n<hr>\n<p>我们先用一个宏来定义数据库的路径，每次通过这个宏来访问数据库路径</p>\n<pre><code>#define kPath_FMDB [NSHomeDirectory() stringByAppendingPathComponent:@&quot;Documents/db.sqlite&quot;]\n</code></pre>\n<h3 id=\"创建操作-CREAT\"><a href=\"#创建操作-CREAT\" class=\"headerlink\" title=\"创建操作 CREAT\"></a>创建操作 <code>CREAT</code></h3><ul>\n<li><p>创建数据库</p>\n</li>\n<li><p>创建表</p>\n</li>\n<li><p>初始化数据库</p>\n</li>\n</ul>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">+ (BOOL) initClientDB\n&#123;\n    __block BOOL result &#x3D; NO;\n    \n   FMDatabaseQueue *queue &#x3D; [FMDatabaseQueue databaseQueueWithPath:kPath_FMDB];\n    \n   [queue inDatabase:^(FMDatabase *db) &#123;\n        \n   NSString *sql &#x3D; [NSString stringWithFormat:@&quot;CREATE TABLE IF NOT EXISTS %@ (content TEXT,qid INTEGER,commentcount INTEGER,likecount INTEGER,imgarray BLOB&quot;,kTableName];\n        result &#x3D; [db executeUpdate:sql];\n\n   &#125;];\n    \n   return result;\n    \n&#125;\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"插入操作-INSERT\"><a href=\"#插入操作-INSERT\" class=\"headerlink\" title=\"插入操作 INSERT\"></a>插入操作 <code>INSERT</code></h3><h3 id=\"查询操作-SELECT\"><a href=\"#查询操作-SELECT\" class=\"headerlink\" title=\"查询操作 SELECT\"></a>查询操作 <code>SELECT</code></h3><ul>\n<li>获取表中某一元素的个数</li>\n</ul>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">\n + (NSInteger)getAllCountFromDB\n &#123;    \n \t __block NSInteger totalCount &#x3D; 0;\n \t   \n    FMDatabaseQueue *queue &#x3D; [FMDatabaseQueue databaseQueueWithPath:kPath_FMDB];\n    \n    [queue inDatabase:^(FMDatabase *db) &#123;\n        \n    NSString *sql &#x3D; [NSString stringWithFormat:@&quot;SELECT COUNT(qid) FROM %@&quot;,kTableName];\n        \n       totalCount &#x3D; [db intForQuery:sql];\n        \n      &#125;];\n    \n    return totalCount;\n&#125;\t\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"删除操作-DELETE\"><a href=\"#删除操作-DELETE\" class=\"headerlink\" title=\"删除操作 DELETE\"></a>删除操作 <code>DELETE</code></h3><ul>\n<li>删除某个表</li>\n<li>删除表中某一个内容</li>\n</ul>\n<h3 id=\"修改操作-UPDATE\"><a href=\"#修改操作-UPDATE\" class=\"headerlink\" title=\"修改操作 UPDATE\"></a>修改操作 <code>UPDATE</code></h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">+ (BOOL)unlikeFromDB:(NSInteger)tid\n&#123;\n    __block BOOL result &#x3D; NO;\n    NSString *sql &#x3D; [NSString stringWithFormat:@&quot;DELETE FROM %@ WHERE tid &#x3D; %zd&quot;,kTableName,tid];\n    \n   FMDatabaseQueue *queue &#x3D; [FMDatabaseQueue databaseQueueWithPath:kPath_FMDB];\n    [queue inDatabase:^(FMDatabase *db) &#123;\n        \n   result &#x3D; [db executeUpdate:sql];\n        if (result) &#123;\n            NSLog(@&quot;取消收藏成功&quot;);\n        &#125; else &#123;\n            NSLog(@&quot;取消收藏失败&quot;);\n        &#125;\n    &#125;];\n    \n   return result;\n&#125;\n<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<h3 id=\"追加字段\"><a href=\"#追加字段\" class=\"headerlink\" title=\"追加字段\"></a>追加字段</h3><pre class=\"line-numbers language-none\"><code class=\"language-none\">if (![db columnExists:@&quot;score&quot; inTableWithName:kWordHomeWordTable]) &#123;\n       \n       [db executeUpdate:@&quot;ALTER TABLE %@ ADD COLUMN score INTEGER default 0&quot;, kTableName];\n       \n   &#125;\n       <span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<hr>\n<p>###一些特殊需求：</p>\n<ul>\n<li><p>数据库中如何存 NSArray和NSDictionary </p>\n<p>  转换成NSData存放</p>\n</li>\n<li><p>数据中如何存放UIImage </p>\n<p>  因为图片太大，所以，一般情况下，数据库中是不存放图片的，只存放图片的路径</p>\n</li>\n<li><p>字段追加(追加一列)</p>\n<p>  <a href=\"http://www.w3school.com.cn/sql/sql_alter.asp\">http://www.w3school.com.cn/sql/sql_alter.asp</a></p>\n</li>\n<li><p>删除一个字段(删除一列)</p>\n<p>  <a href=\"http://www.w3school.com.cn/sql/sql_alter.asp\">http://www.w3school.com.cn/sql/sql_alter.asp</a></p>\n</li>\n</ul>\n<hr>\n<p>在写SQL语句的时候,SQL语句大写，变量小写，方便区分。</p>\n<hr>\n<ul>\n<li>如果遇到一些自己不会写的SQL语句，可以去<a href=\"http://www.w3school.com.cn/sql/index.asp\">http://www.w3school.com.cn/sql/index.asp</a> 学习。</li>\n</ul>\n<hr>\n<p>(待整理和完善)</p>\n","text":"关于这篇Blog: 网上也有不少写FMDB用法的，我为什么还在这里重造轮子？有两个目的：1、自己做总结和备忘，在项目里会常用的东西2、 FMDB介绍：下载地址：https://github.com/ccgus/fmdb 如何集成1、如果你的工程使用了CocoaPods进行管理，直...","link":"","photos":[],"count_time":{"symbolsCount":"2.6k","symbolsTime":"2 mins."},"categories":[{"name":"iOS","slug":"iOS","count":36,"path":"api/categories/iOS.json"}],"tags":[{"name":"FMDB","slug":"FMDB","count":1,"path":"api/tags/FMDB.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#FMDB%E4%BB%8B%E7%BB%8D%EF%BC%9A\"><span class=\"toc-text\">FMDB介绍：</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%A6%82%E4%BD%95%E9%9B%86%E6%88%90\"><span class=\"toc-text\">如何集成</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%88%9B%E5%BB%BA%E6%93%8D%E4%BD%9C-CREAT\"><span class=\"toc-text\">创建操作 CREAT</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%8F%92%E5%85%A5%E6%93%8D%E4%BD%9C-INSERT\"><span class=\"toc-text\">插入操作 INSERT</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%9F%A5%E8%AF%A2%E6%93%8D%E4%BD%9C-SELECT\"><span class=\"toc-text\">查询操作 SELECT</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E5%88%A0%E9%99%A4%E6%93%8D%E4%BD%9C-DELETE\"><span class=\"toc-text\">删除操作 DELETE</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E4%BF%AE%E6%94%B9%E6%93%8D%E4%BD%9C-UPDATE\"><span class=\"toc-text\">修改操作 UPDATE</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%BF%BD%E5%8A%A0%E5%AD%97%E6%AE%B5\"><span class=\"toc-text\">追加字段</span></a></li></ol>","author":{"name":"新风作浪","slug":"blog-author","avatar":"http://qiniu.niuxtech.cn/avatar.png","link":"/","description":"专注于你能控制的","socials":{"github":"https://github.com/duxinfeng","twitter":"https://twitter.com/iduxinfeng","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/duxinfeng2010","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"RESideMenu源码学习","uid":"fcf55b2f11bf571a37815147521a9750","slug":"RESideMenu源码学习","date":"2015-07-12T14:40:03.000Z","updated":"2020-03-28T12:35:00.000Z","comments":true,"path":"api/articles/RESideMenu源码学习.json","keywords":null,"cover":[],"text":"RESideMenu下载地址：https://github.com/romaonthego/RESideMenu RESideMenu 有三个类，RECommonFunctions，RESideMenu，UIViewController+RESideMenu，核心RESideMe...","link":"","photos":[],"count_time":{"symbolsCount":"1.7k","symbolsTime":"2 mins."},"categories":[{"name":"iOS","slug":"iOS","count":36,"path":"api/categories/iOS.json"}],"tags":[{"name":"RESideMenu","slug":"RESideMenu","count":1,"path":"api/tags/RESideMenu.json"}],"author":{"name":"新风作浪","slug":"blog-author","avatar":"http://qiniu.niuxtech.cn/avatar.png","link":"/","description":"专注于你能控制的","socials":{"github":"https://github.com/duxinfeng","twitter":"https://twitter.com/iduxinfeng","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/duxinfeng2010","juejin":"","customs":{}}}},"next_post":{"title":"升级到Xcode6.4后插件失效解决办法","uid":"0686148ee45bcbbff09c1cfd7525d74f","slug":"升级到Xcode6-4后插件失效解决办法","date":"2015-07-08T05:53:02.000Z","updated":"2017-04-27T13:13:04.000Z","comments":true,"path":"api/articles/升级到Xcode6-4后插件失效解决办法.json","keywords":null,"cover":null,"text":" 升级到Xcode 6.4 之后，插件失效不能使用， 1、首先要知道xcode的UUID,在终端下输入以下命令，会打开一个info.plist的文件，复制DVTPlugInCompatibilityUUID对应的值。 open /Applications/Xcode.app/Co...","link":"","photos":[],"count_time":{"symbolsCount":601,"symbolsTime":"1 mins."},"categories":[{"name":"iOS","slug":"iOS","count":36,"path":"api/categories/iOS.json"}],"tags":[{"name":"Xcode","slug":"Xcode","count":6,"path":"api/tags/Xcode.json"},{"name":"插件","slug":"插件","count":1,"path":"api/tags/插件.json"}],"author":{"name":"新风作浪","slug":"blog-author","avatar":"http://qiniu.niuxtech.cn/avatar.png","link":"/","description":"专注于你能控制的","socials":{"github":"https://github.com/duxinfeng","twitter":"https://twitter.com/iduxinfeng","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/duxinfeng2010","juejin":"","customs":{}}}}}