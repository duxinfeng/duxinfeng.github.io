{"title":"Mantle使用问题: MTLTransformerErrorHandlingErrorDomain","uid":"581dee1e08020fd9cc4dbeeb17e69779","slug":"Mantle使用问题-MTLTransformerErrorHandlingErrorDomain","date":"2015-10-29T06:00:41.000Z","updated":"2017-04-27T13:03:41.000Z","comments":true,"path":"api/articles/Mantle使用问题-MTLTransformerErrorHandlingErrorDomain.json","keywords":null,"cover":null,"content":"<p>再使用Mantle序列化JSON文件的时候程序一直crash，使用断点判断到获取<code>model</code>却一直为<code>nil</code>，然后把这个空对象add到数组里的时候就崩了。</p>\n<pre><code>for (NSDictionary *attributes in responsearray) &#123;\n            NSError *error = nil;\n            BookDetailsModel *model = [MTLJSONAdapter modelOfClass:[BookDetailsModel class] fromJSONDictionary:attributes error:&amp;error];\n            DLog(@&quot;--&gt;%@&quot;,error.description);\n            [mutablearray addObject:model];\n        &#125;\n        \n</code></pre>\n<p>Error description：</p>\n<p>Domain=MTLTransformerErrorHandlingErrorDomain Code=1 “Value did not match expected type” UserInfo={MTLTransformerErrorHandlingInputValueErrorKey=7, NSLocalizedDescription=Value did not match expected type, NSLocalizedFailureReason=Expected 7 to be of class NSNumber but got NSTaggedPointerString}</p>\n<p>大意也就是说声明的NSNumber类型变量不能匹配到相应的类型。一些数据格式如下：</p>\n<p>从服务器端拉倒数据之后JSON信息：</p>\n<pre><code> &#123;\n        &quot;title&quot;: &quot;北师版三年级上册语文&quot;,\n        &quot;grade&quot;: &quot;&quot;,\n        &quot;image_id&quot;: 8821,\n        &quot;edition&quot;: &quot;北师大版电子课本&quot;,\n        &quot;mp3_path&quot;: &quot;http://file.haojiazhang123.com/static/server/tom61_kejian/598/99/mp3/9.mp3&quot;,\n        &quot;path&quot;: &quot;http://file.haojiazhang123.com/static/server/tom61_kejian/907/106/img/7.jpg&quot;,\n        &quot;lesson&quot;: null,\n        &quot;page&quot;: &quot;7&quot;,\n        &quot;subject&quot;: &quot;&quot;\n    &#125;,\n    &#123;\n        &quot;title&quot;: &quot;北师版三年级上册语文&quot;,\n        &quot;grade&quot;: &quot;&quot;,\n        &quot;image_id&quot;: 8847,\n        &quot;edition&quot;: &quot;北师大版电子课本&quot;,\n        &quot;mp3_path&quot;: &quot;&quot;,\n        &quot;path&quot;: &quot;http://file.haojiazhang123.com/static/server/tom61_kejian/907/106/img/8.jpg&quot;,\n        &quot;lesson&quot;: null,\n        &quot;page&quot;: &quot;8&quot;,\n        &quot;subject&quot;: &quot;&quot;\n    &#125;\n</code></pre>\n<p>客户端获取数据后放到数组里，数组里的字典格式（不理解为什么变量有的双引号有的没有，和在网页上获取内容不全一样，双引号问题）：</p>\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&#123;\n    edition &#x3D; &quot;\\U5317\\U5e08\\U5927\\U7248\\U7535\\U5b50\\U8bfe\\U672c&quot;;\n    grade &#x3D; &quot;&quot;;\n    &quot;image_id&quot; &#x3D; 8821;\n    lesson &#x3D; &quot;&lt;null&gt;&quot;;\n    &quot;mp3_path&quot; &#x3D; &quot;http:&#x2F;&#x2F;file.haojiazhang123.com&#x2F;static&#x2F;server&#x2F;tom61_kejian&#x2F;598&#x2F;99&#x2F;mp3&#x2F;9.mp3&quot;;\n    page &#x3D; 7;\n    path &#x3D; &quot;http:&#x2F;&#x2F;file.haojiazhang123.com&#x2F;static&#x2F;server&#x2F;tom61_kejian&#x2F;907&#x2F;106&#x2F;img&#x2F;7.jpg&quot;;\n    subject &#x3D; &quot;&quot;;\n    title &#x3D; &quot;\\U5317\\U5e08\\U7248\\U4e09\\U5e74\\U7ea7\\U4e0a\\U518c\\U8bed\\U6587&quot;;\n&#125;,\n&#123;\n    edition &#x3D; &quot;\\U5317\\U5e08\\U5927\\U7248\\U7535\\U5b50\\U8bfe\\U672c&quot;;\n    grade &#x3D; &quot;&quot;;\n    &quot;image_id&quot; &#x3D; 8847;\n    lesson &#x3D; &quot;&lt;null&gt;&quot;;\n    &quot;mp3_path&quot; &#x3D; &quot;&quot;;\n    page &#x3D; 8;\n    path &#x3D; &quot;http:&#x2F;&#x2F;file.haojiazhang123.com&#x2F;static&#x2F;server&#x2F;tom61_kejian&#x2F;907&#x2F;106&#x2F;img&#x2F;8.jpg&quot;;\n    subject &#x3D; &quot;&quot;;\n    title &#x3D; &quot;\\U5317\\U5e08\\U7248\\U4e09\\U5e74\\U7ea7\\U4e0a\\U518c\\U8bed\\U6587&quot;;\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<pre class=\"line-numbers language-none\"><code class=\"language-none\">&#x2F;&#x2F; .h 文件\n@property (nonatomic, copy) NSString* title;\n@property (nonatomic, copy) NSString* grade;\n@property (nonatomic, strong) NSNumber* image_id;\n@property (nonatomic, copy) NSString* edition;\n@property (nonatomic, copy) NSString* mp3_path;\n@property (nonatomic, copy) NSString* path;\n@property (nonatomic, copy) NSString* lesson;\n@property (nonatomic, strong) NSNumber* page;\n@property (nonatomic, copy) NSString* subject;\n\n&#x2F;&#x2F; .m 文件\n+ (NSDictionary *)JSONKeyPathsByPropertyKey\n&#123;\n    return @&#123;\n             @&quot;title&quot;: @&quot;title&quot;,\n             @&quot;grade&quot;: @&quot;grade&quot;,\n             @&quot;image_id&quot;: @&quot;image_id&quot;,\n             @&quot;edition&quot;: @&quot;edition&quot;,\n             @&quot;mp3_path&quot;: @&quot;mp3_path&quot;,\n             @&quot;path&quot;: @&quot;path&quot;,\n             @&quot;lesson&quot;: @&quot;lesson&quot;,\n             @&quot;page&quot;: @&quot;page&quot;,\n             @&quot;subject&quot;: @&quot;subject&quot;\n             &#125;;\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>\n\n<p>搞了半天，就在我想Mantle的Github repo上添加issue的时候发现，服务器端返回的数据时候：”image_id” = 8821; “mp3_path” = “”; 前面说到的变量的有双引号有的没有，然后和后台沟通也没查出什么问题，因为在postman上获取接口信息的时候根本没问题。</p>\n<p>然后呢，我就开始注释<code>.m</code>文件里代码，让他一个个变量的获取，看看是在获取那个变量的时候出问题，果然查出来是 page变量的问题，服务前返回的是String类型，因为是数据接口潜意识写成NSNumer类型来接受。改成<code>@property (nonatomic, copy) NSNumber* page;</code>就没有问题了。好吧归根结底还是命名规范的问题。</p>\n<hr>\n<p>####后记</p>\n<p>在使用Mantle的时候还是会有一些其他的坑存在，像数据类型不要用NSInteger、int,最好用NSNumer接受，如果服务器端返回的数据为nil，程序就crash掉了。issue的问题<a href=\"https://github.com/Mantle/Mantle/issues/595\">https://github.com/Mantle/Mantle/issues/595</a>，还有一些其他坑在，如：接受NSURL对象，但是URL字符串包含中文<a href=\"http://duxinfeng.com/2015/07/26/Mantle%E7%9A%84%E4%BD%BF%E7%94%A8\">http://duxinfeng.com/2015/07/26/Mantle%E7%9A%84%E4%BD%BF%E7%94%A8</a></p>\n","text":"再使用Mantle序列化JSON文件的时候程序一直crash，使用断点判断到获取model却一直为nil，然后把这个空对象add到数组里的时候就崩了。 for (NSDictionary *attributes in responsearray) &#123; NSError *...","link":"","photos":[],"count_time":{"symbolsCount":"4.7k","symbolsTime":"4 mins."},"categories":[{"name":"iOS","slug":"iOS","count":37,"path":"api/categories/iOS.json"}],"tags":[{"name":"Mantle","slug":"Mantle","count":2,"path":"api/tags/Mantle.json"}],"toc":"","author":{"name":"新风作浪","slug":"blog-author","avatar":"http://qiniu.niuxtech.cn/avatar.png","link":"/","description":"专注于你能控制的","socials":{"github":"https://github.com/duxinfeng","twitter":"https://twitter.com/iduxinfeng","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/duxinfeng2010","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"ERROR ITMS-90046:Invalid Code Signing Entitlements","uid":"0b82e3e25e5e1e7de7cc5297ce2fe095","slug":"ERROR-ITMS-90046-Invalid-Code-Signing-Entitlements","date":"2015-11-03T15:58:47.000Z","updated":"2020-03-11T15:37:42.000Z","comments":true,"path":"api/articles/ERROR-ITMS-90046-Invalid-Code-Signing-Entitlements.json","keywords":null,"cover":null,"text":"###使用Xcode 7 打包上传app时候环境没变突然报错，如下： ERROR ITMS-90046: &quot;Invalid Code Signing Entitlements. Your application bundle&#39;s signature contai...","link":"","photos":[],"count_time":{"symbolsCount":414,"symbolsTime":"1 mins."},"categories":[{"name":"iOS","slug":"iOS","count":37,"path":"api/categories/iOS.json"}],"tags":[{"name":"Xcode","slug":"Xcode","count":6,"path":"api/tags/Xcode.json"},{"name":"打包","slug":"打包","count":3,"path":"api/tags/打包.json"}],"author":{"name":"新风作浪","slug":"blog-author","avatar":"http://qiniu.niuxtech.cn/avatar.png","link":"/","description":"专注于你能控制的","socials":{"github":"https://github.com/duxinfeng","twitter":"https://twitter.com/iduxinfeng","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/duxinfeng2010","juejin":"","customs":{}}}},"next_post":{"title":"怎么判断viewcontroller是Push还是Pop?","uid":"63b43c91c0890ec7ca617caa4acca74f","slug":"怎么判断viewcontroller是Push还是Pop","date":"2015-10-23T07:33:35.000Z","updated":"2020-03-28T15:50:24.000Z","comments":true,"path":"api/articles/怎么判断viewcontroller是Push还是Pop.json","keywords":null,"cover":null,"text":"一般情况下判断viewcontroller在返回时需要push还是pop都会在.h文件带一个参数进来。如何让容器自己判断？ 方法一NSArray* views = [self.navigationController viewControllers]; BOOL variable...","link":"","photos":[],"count_time":{"symbolsCount":690,"symbolsTime":"1 mins."},"categories":[{"name":"iOS","slug":"iOS","count":37,"path":"api/categories/iOS.json"}],"tags":[],"author":{"name":"新风作浪","slug":"blog-author","avatar":"http://qiniu.niuxtech.cn/avatar.png","link":"/","description":"专注于你能控制的","socials":{"github":"https://github.com/duxinfeng","twitter":"https://twitter.com/iduxinfeng","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"https://blog.csdn.net/duxinfeng2010","juejin":"","customs":{}}}}}